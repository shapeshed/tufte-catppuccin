{{ define "title" }}{{ .Title }} | {{ .Site.Title }}{{ end }}
{{ define "main" }}
  <article>
        <script type="application/ld+json">
          {
            "@context": "http://schema.org",
            "@type": "BlogPosting",
            "mainEntityOfPage":{
              "@type":"WebPage",
              "@id":"{{ .Site.BaseURL }}"
            },
            "headline": {{ .Title }},
            "image": {
              "@type": "ImageObject",{{ with resources.GetMatch .Params.image }}
              "url": "{{ .Permalink }}",
              "height": "{{ .Height }}",
              "width": "{{ .Width }}"
              {{ else }} 
              "url": "{{ .Site.BaseURL }}images/george-700.jpg",
              "height": 700,
              "width": 700
              {{ end }}
            },
            "copyrightYear" : "{{ .Date.Format "2006" }}",
            "url" : "{{ .Permalink }}",
            "datePublished": "{{ .Date.Format "2006-01-02T15:04:05JST" }}",
            "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05JST" }}",
            "author": {
              "@type": "Person",
              "name": "{{ .Site.Params.author }}",
              "image": "{{ .Site.BaseURL }}images/george-400.jpg"
            },
            "publisher": {
              "@type": "Organization",
              "name": "{{ .Site.Copyright }}",
              "logo": {
                "@type": "ImageObject",
                "url": "{{ .Site.BaseURL }}images/george-60.jpg",
                "height": 60,
                "width": 60
              }
            },
            "description": {{ .Description | html }},
            "timeRequired": "{{ .ReadingTime }} minutes",
            "wordCount": "{{ .WordCount }}",
            "articleBody": {{ .Content | html }},
            "keywords" : [ {{ range $i, $e := .Params.tags }}{{ if $i }}, {{ end }}{{ $e }}{{ end }} ]
          }
        </script>
    <h1>{{ .Title }}</h1>
    <!-- 1600 x 1200 for cover image -->
    <!-- resized to 620 q85 h2 lanczos -->
    <!-- resized to 860 q80 h2 lanczos -->
    <!-- resized to 1200 q40 h2 lanczos -->
    <!-- resized to 1200 q30 h2 lanczos -->
    {{ with page.Description }}
      <p>{{ . }}</p>
    {{ end }}
    <aside class="three-row">
      <ul class="meta">
        <li>
          <time
            datetime="{{ .PublishDate.Format "2006-01-02T15:04:05" }}"
            data-updated="true"
            ><span class="uppercase"
              >{{ .PublishDate.Format "January 2, 2006" }}</span
            ></time
          >
        </li>
        <li>
          Updated
          <time
            datetime="{{ .Lastmod.Format "2006-01-02T15:04:05" }}"
            data-updated="true"
            >{{ .Lastmod.Format "January 2, 2006" }}</time
          >
        </li>
        {{ range .Params.tags }}
          <li class="tag"><a href="/tags/{{ . | urlize }}/">{{ . }}</a></li>
        {{ end }}
      </ul>
    </aside>

    {{ with resources.GetMatch .Params.image }}
      {{ $image := resources.Get . }}


      <!-- 16:9 2048:1152 -->
      <!-- 4:3 2048:1536 -->
      {{ $mobileImageWebP := $image.Resize "620x q70 Lanczos webp" }}
      {{ $imageWebP := $image.Resize "860x q90 Lanczos webp" }}
      {{ $mobileImage := $image.Resize "620x q40 Lanczos" }}
      {{ $image := $image.Resize "860x q40 Lanczos" }}


      <figure>
        <picture>
          <source
            media="(max-width: 767px)"
            srcset="{{ $mobileImageWebP.Permalink }}"
          >
          <source
            media="(min-width: 768px)"
            srcset="{{ $imageWebP.Permalink }}"
          >
          <source
            media="(max-width: 767px)"
            srcset="{{ $mobileImage.Permalink }}"
          >
          <source media="(min-width: 768px)" srcset="{{ $image.Permalink }}" />
          <img src="{{ $image.Permalink }}" alt="{{ $.Params.caption }}" width="{{ $image.Width }}" height="{{ $image.Height }}" />
        </picture>
        {{ with $.Params.caption }}
          <figcaption>{{ $.Params.caption }}</figcaption>
        {{ end }}
      </figure>
    {{ end }}

    {{ .Content }}
    {{ if not (in .Params.tags "Writing") }}
      <p class="kaizen">
        Can you help make this article better?
        <a
          href="https://github.com/shapeshed/shapeshed.com/edit/main/content/{{ .File.Path }}
              "
          >You can edit it here and send me a pull request.</a
        >
      </p>

      {{ if not (in .Params.tags "Writing") }}
        {{ partial "related.html" . }}
      {{ end }}
    {{ end }}
  </article>
{{ end }}
